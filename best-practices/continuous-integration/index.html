<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="fastlane team">
  
  <title>Continuous Integration - fastlane docs</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/breadcrumbs.css" rel="stylesheet">
  <link href="../../css/code.css" rel="stylesheet">
  <link href="../../css/fabric.css" rel="stylesheet">
  <link href="../../css/fastlane.css" rel="stylesheet">
  <link href="../../css/sidenav.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous Integration";
    var mkdocs_page_input_path = "best-practices/continuous-integration.md";
    var mkdocs_page_url = "/best-practices/continuous-integration/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-18658848-13', 'docs.fastlane.tools');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> fastlane docs</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../..">Home</a>
      
    </li>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Getting Started</span></li>
      
      
  
    <ul class="subnav">
      <li><span>iOS</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/ios/setup/">Setup</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/ios/running-tests/">Running Tests</a>
      
    </li>
  

      
      
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/ios/screenshots/">Screenshots</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/ios/beta-deployment/">Beta Deployment</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/ios/appstore-deployment/">App Store Deployment</a>
      
    </li>
  

      
    </ul>
  

      
      
  
    <ul class="subnav">
      <li><span>Android</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/android/setup/">Setup</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/android/running-tests/">Running Tests</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/android/screenshots/">Screenshots</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/android/beta-deployment/">Beta Deployment</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../getting-started/android/release-deployment/">Release Deployment</a>
      
    </li>
  

      
    </ul>
  

      
    </ul>
  
<li>
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../../actions/">Actions</a>
      
    </li>
  
<li>
          
            <li>
  
<li>
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../../faqs/">FAQs</a>
      
    </li>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Codesigning</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../codesigning/getting-started/">Getting Started</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../codesigning/xcode-project/">Xcode Project</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../codesigning/troubleshooting/">Troubleshooting</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../codesigning/common-issues/">Common Issues</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Plugins</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../plugins/available-plugins/">Available Plugins</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../plugins/create-plugin/">Create Your Own Plugin</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../../plugins/plugins-troubleshooting/">Plugins Troubleshooting</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Best Practices</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../source-control/">Source Control</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 current">
      <a class="current" href="./">Continuous Integration</a>
      
      <ul>
        
          
        
          
          <li class="toctree-l3"><a href="#best-practices">Best Practices</a></li>
          
        
          
          <li class="toctree-l3"><a href="#fastlaneci">fastlane.ci</a></li>
          
        
          
          <li class="toctree-l3"><a href="#jenkins-integration">Jenkins Integration</a></li>
          
        
          
          <li class="toctree-l3"><a href="#circleci-integration">CircleCI Integration</a></li>
          
        
          
          <li class="toctree-l3"><a href="#travis-integration">Travis Integration</a></li>
          
        
          
          <li class="toctree-l3"><a href="#bamboo-integration">Bamboo Integration</a></li>
          
        
          
          <li class="toctree-l3"><a href="#gitlab-ci-integration">GitLab CI Integration</a></li>
          
        
          
          <li class="toctree-l3"><a href="#visual-studio-team-services">Visual Studio Team Services</a></li>
          
        
          
          <li class="toctree-l3"><a href="#nevercode-integration">Nevercode Integration</a></li>
          
        
      </ul>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../keys/">Keys</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../../advanced/">Advanced</a>
      
    </li>
  
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">fastlane docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Best Practices &raquo;</li>
        
      
    
    <li>Continuous Integration</li>

    
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/fastlane/docs/edit/master/docs/best-practices/continuous-integration.md" class="icon icon-github" target="_blank">
            Edit on GitHub
          </a>
        
      </li>
    
    <li class="wy-breadcrumbs-aside">
      <input type="text" name="q" placeholder="Search docs" />
    </li>
  </ul>
  <hr/>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<!-- at the end of the BODY -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    apiKey: 'c651753b86f5f8a00f8f2e9e9ca95865',
    indexName: 'fastlane',
    inputSelector: 'body > div.wy-grid-for-nav > section > div > div > div:nth-child(1) > ul > li.wy-breadcrumbs-aside > input[type="text"]',
    debug: false
});
</script>
          <div role="main">
            <div class="section">
              
                <style type="text/css">
  .fastlane-setup {
    border-left: .4rem solid #00b0ff;
    border-bottom: .1rem solid rgba(0,176,255,.1);
    background-color: rgba(0,176,255,.1);
    padding: 15px;
    margin-bottom: 20px;
    font-weight: 200;
  }
  .fastlane-setup-wrapper {
    background-color: rgba(0,176,255,.05);
  }
  .fastlane-setup-wrapper[open] {
    padding-bottom: 1px;
  }
  .fastlane-setup-header {
    font-size: 20px;
    font-weight: 500;
  }
  .fastlane-setup-more-details {
    font-size: 18px;
    font-weight: 350;
  }
</style>

<p><details class="fastlane-setup-wrapper">
  <summary class="fastlane-setup">New to fastlane? Click here to open the installation &amp; setup instructions first</summary></p>
<p class="fastlane-setup-header">1) Install the latest Xcode command line tools</p>

<pre><code class="no-highlight">xcode-select --install
</code></pre>

<p class="fastlane-setup-header">2) Install <i>fastlane</i></p>

<pre><code class="sh"># Using RubyGems
sudo gem install fastlane -NV

# Alternatively using Homebrew
brew cask install fastlane
</code></pre>

<p class="fastlane-setup-header">3) Navigate to your project and run</p>

<pre><code class="no-highlight">fastlane init
</code></pre>

<p class="fastlane-setup-more-details"><a href="/getting-started/ios/setup/">More Details</a></p>

<p></details></p>
<h1 id="continuous-integration"><a name="user-content-continuous-integration" href="#continuous-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Continuous Integration</h1>
<h1 id="best-practices"><a name="user-content-best-practices" href="#best-practices" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Best Practices</h1>
<h2 id="two-step-or-two-factor-auth"><a name="user-content-two-step-or-two-factor-auth" href="#two-step-or-two-factor-auth" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Two-step or Two-factor auth</h2>
<h3 id="separate-apple-id-for-ci"><a name="user-content-separate-apple-id-for-ci" href="#separate-apple-id-for-ci" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Separate Apple ID for CI</h3>
<p>The easiest way to get <em>fastlane</em> running on a CI system is to create a separate Apple ID that doesn't have 2-factor auth enabled, with a long, randomly generated password. Additionally make sure the newly created Apple account has limited access to only the apps and resources it needs.</p>
<p>There are multiple reasons on why this approach is much easier:</p>
<ul>
<li>An Apple ID session is only valid for a certain region, meaning if your CI system is in a different region than your local machine, you'll run into issues</li>
<li>An Apple ID session is only valid for up to a month, meaning you'll have to generate a new session every month. Usually you'd only know about it when your build starts failing</li>
</ul>
<p>There is nothing <em>fastlane</em> can do better in that regard, as these are technical limitations on how App Store Connect sessions are handled.</p>
<p>Creating a separate Apple ID allows you to limit the permission scope, have a randomly generated password, and will make it much easier for you to set up CI using <em>fastlane</em>.</p>
<h3 id="use-of-application-specific-passwords-and-spaceauth"><a name="user-content-use-of-application-specific-passwords-and-spaceauth" href="#use-of-application-specific-passwords-and-spaceauth" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Use of application specific passwords and <code>spaceauth</code></h3>
<p>Before going through this guide, make sure to read the section above.</p>
<p>If you want to upload builds to TestFlight / App Store Connect from your CI machine, you need to generate an application specific password:</p>
<ol>
<li>Visit <a href="https://appleid.apple.com/account/manage">appleid.apple.com/account/manage</a></li>
<li>Generate a new application specific password</li>
<li>Provide the application specific password using the environment variable <code>FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD</code></li>
</ol>
<p>Because your CI machine will not be able to prompt you for your two-step or two-factor auth information, you also need to generate a login session for your CI machine in advance. You can get this by running:</p>
<pre><code>fastlane spaceauth -u user@email.com
</code></pre>

<p>This will generate a token you can set using the <code>FASTLANE_SESSION</code> environment variable on your CI system.</p>
<h2 id="environment-variables-to-set"><a name="user-content-environment-variables-to-set" href="#environment-variables-to-set" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Environment variables to set</h2>
<p>Most setups will need the following environment variables</p>
<ul>
<li><code>FASTLANE_USER</code>: Your App Store Connect / Dev Portal user, if your <em>fastlane</em> setup accesses iTC or the DevPortal (e.g. submit a TestFlight build, create a profile, ...)</li>
<li><code>FASTLANE_PASSWORD</code>: Your App Store Connect / Dev Portal password, usually only needed if you also set the <code>FASTLANE_USER</code> variable</li>
<li><code>MATCH_PASSWORD</code>: You need to provide the password of your <em>match</em> encryption if you use <em>match</em></li>
<li><code>FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD</code>: You need to provide an <a href="#two-step-or-two-factor-auth">application specific password</a> if you have 2-factor enabled and use <em>pilot</em> or <em>deliver</em> to upload a binary to App Store Connect</li>
<li><code>LANG</code> and <code>LC_ALL</code>: These set up the locale your shell and all the commands you execute run at. <em>fastlane</em> needs these to be set to an UTF-8 locale to work correctly, for example <code>en_US.UTF-8</code>. Many CI systems come with a locale that is unset or set to ASCII by default, so make sure to double-check whether yours is set correctly.</li>
</ul>
<h2 id="deploy-strategy"><a name="user-content-deploy-strategy" href="#deploy-strategy" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Deploy Strategy</h2>
<p>You should <strong>not</strong> deploy a new App Store update after every commit, since you still have to wait 1-2 days for the review. Instead it is recommended that you use Git Tags, or custom triggers to deploy a new update.</p>
<p>You can set up your own <code>Release</code> job, which is only triggered manually.</p>
<h1 id="fastlaneci"><a href="https://github.com/fastlane/ci">fastlane.ci</a></h1>
<p>Since January 2018, the <em>fastlane</em> team started working on <a href="https://github.com/fastlane/ci">fastlane.ci</a>, an open source, self hosted, mobile optimized CI powered by <em>fastlane</em>.</p>
<p>It's still an early work in progress, and will take some time to be ready for production.</p>
<h1 id="jenkins-integration"><a name="user-content-jenkins-integration" href="#jenkins-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Jenkins Integration</h1>
<p>Deploying from your own computer isn't cool. You know what's cool? Letting a remote server publish app updates for you.</p>
<p><em>fastlane</em> automatically generates a JUnit report for you. This allows Continuous Integration systems, like <code>Jenkins</code>, access the results of your deployment.</p>
<h2 id="installation"><a name="user-content-installation" href="#installation" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Installation</h2>
<p>The recommended way to install <a href="http://jenkins-ci.org/">Jenkins</a> is through <a href="http://brew.sh/">homebrew</a>:</p>
<pre><code class="no-highlight">brew update &amp;&amp; brew install jenkins
</code></pre>

<p>From now on start <code>Jenkins</code> by running:</p>
<pre><code class="no-highlight">jenkins
</code></pre>

<p>To store the password in the Keychain of your remote machine, it is recommended that you run <em>match</em> or <em>deliver</em> using ssh or remote desktop at least once.</p>
<h2 id="ruby-environment"><a name="user-content-ruby-environment" href="#ruby-environment" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Ruby Environment</h2>
<p>We recommend using <a href="https://github.com/rbenv/rbenv">rbenv</a> for installing Ruby, though <a href="https://rvm.io/">rvm</a> and the version of Ruby that comes bundled on macOS are fine too.</p>
<p>If using a Gemfile in your project, add an "Execute shell" step as your first build step and call <code>bundle update</code>.</p>
<h2 id="plugins"><a name="user-content-plugins" href="#plugins" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Plugins</h2>
<p>You'll find the following Jenkins plugins to be useful:</p>
<p>(note: We do not recommend installing the Xcode plugin)</p>
<ul>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin">HTML Publisher Plugin</a>:</strong> Can be used to show the generated screenshots right inside Jenkins.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/AnsiColor+Plugin">AnsiColor Plugin</a>:</strong> Used to show the coloured output of the fastlane tools. Don’t forget to enable <code>Color ANSI Console Output</code> in the <code>Build Environment</code> or your project.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/Rebuild+Plugin">Rebuild Plugin</a>:</strong> This plugin will save you a lot of time.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/Keychains+and+Provisioning+Profiles+Plugin">Keychains and Provisioning Profiles Plugin</a>:</strong> Manages keychains across Jenkins installations.</li>
</ul>
<h2 id="build-step"><a name="user-content-build-step" href="#build-step" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Build Step</h2>
<p>Add an "Execute shell" build step using your appropriate <em>fastlane</em> command per the example below:</p>
<pre><code class="no-highlight">fastlane appstore
</code></pre>

<p>Replace <code>appstore</code> with the lane you want to use.</p>
<p>(note: if using a Gemfile, prefix that command with <code>bundle exec</code>)</p>
<h3 id="setup_jenkins"><a name="user-content-setup_jenkins" href="#setup_jenkins" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>setup_jenkins</h3>
<p>You can use <code>setup_jenkins</code> action which integrates well with the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Keychains+and+Provisioning+Profiles+Plugin">Keychains and Provisioning Profiles Plugin</a>. Selected keychain will automatically unlocked and the selected code signing identity will be used. Also all build results, like IPA files, archives, dSYMs and result bundles will be stored in the <code>./output</code> folder in the job workspace. In additions <code>setup_jenkins</code> will create separate derived data folder for each job (in the <code>./derivedData</code>).</p>
<p>Under the hood <code>setup_jenkins</code> configures other actions like: <em>gym</em>, <em>scan</em>, <code>xcodebuild</code>, <code>backup_xcarchive</code> and <code>clear_derived_data</code>.</p>
<h3 id="commit_version_bump-git_commit"><a name="user-content-commit_version_bump-git_commit" href="#commit_version_bump-git_commit" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>commit_version_bump || git_commit</h3>
<p>You can use <code>commit_version_bump</code> or <code>git_commit</code> action to commit changes to your repository in your fastlane setup. When you are using webhooks to trigger your build on a push this will cause an infinite loop of triggering builds.</p>
<h4 id="gitlab"><a name="user-content-gitlab" href="#gitlab" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Gitlab</h4>
<p>When you are using Gitlab you will need the <a href="https://wiki.jenkins-ci.org/display/JENKINS/GitLab+Plugin">GitLab Plugin</a>. Inside the job you want to configure you go to <code>Build Triggers &gt; Build when a change is pushed to GitLab &gt; Enable [ci-skip]</code>.
When you include <code>[ci-skip]</code> in your build this commit won't trigger the build in jenkins at all.</p>
<p><strong>Example</strong>  </p>
<pre><code class="ruby">build_number = increment_build_number
commit_version_bump(message:&quot;[ci-skip] Version Bump to #{build_number}&quot;)
git_commit(path:&quot;./CHANGELOG.md&quot;, message:&quot;[ci-skip] Updated CHANGELOG for Build #{build_number}&quot;)
push_to_git_remote
</code></pre>

<h2 id="test-results-and-screenshots"><a name="user-content-test-results-and-screenshots" href="#test-results-and-screenshots" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Test Results and Screenshots</h2>
<p>To show the <strong>deployment result</strong> right in <code>Jenkins</code></p>
<ul>
<li><em>Add post-build action</em></li>
<li><em>Publish JUnit test result report</em></li>
<li><em>Test report XMLs</em>: <code>fastlane/report.xml</code></li>
</ul>
<p>To show the <strong>generated screenshots</strong> right in <code>Jenkins</code></p>
<ul>
<li><em>Add post-build action</em></li>
<li><em>Publish HTML reports</em></li>
<li><em>HTML directory to archive</em>: <code>fastlane/screenshots</code></li>
<li><em>Index page</em>: <code>screenshots.html</code></li>
</ul>
<p>Save and run. The result should look like this:</p>
<p><img alt="/img/best-practices/JenkinsIntegration.png" src="../../img/best-practices/JenkinsIntegration.png" /></p>
<h1 id="circleci-integration"><a name="user-content-circleci-integration" href="#circleci-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>CircleCI Integration</h1>
<p>To run fastlane on CircleCI, first create a <code>Gemfile</code> in the root of your project with the following content:</p>
<pre><code class="ruby"># Gemfile
source &quot;https://rubygems.org&quot;

gem &quot;fastlane&quot;
</code></pre>

<p>and run</p>
<pre><code class="no-highlight">gem install bundler &amp;&amp; bundle update
</code></pre>

<p>This will create a <code>Gemfile.lock</code> that defines all Ruby dependencies.  Make sure
to commit both files to version control.</p>
<p>Next, add the following to your <code>Fastfile</code>:</p>
<pre><code class="ruby"># fastlane/Fastfile

...
platform :ios do
  before_all do
    setup_circle_ci
  end
  ...
end
</code></pre>

<p>The <code>setup_circle_ci</code> <em>fastlane</em> action will perform the following actions:</p>
<ul>
<li>Create a new temporary keychain for use with
  <a href="https://fastlane.tools/match"><em>match</em></a> (see the <a href="https://circleci.com/docs/2.0/ios-codesigning/">CircleCI code signing
  doc</a> for more details).</li>
<li>Switch <em>match</em> to readonly mode to make sure CI does not create new
  code signing certificates or provisioning profiles.</li>
<li>Set up log and test result paths to be easily collectible.</li>
</ul>
<p>Next, create a <code>.circleci</code> directory in your project and add a
<code>.circleci/config.yml</code> with the following content:</p>
<pre><code class="yml"># .circleci/config.yml

version: 2
jobs:
  build:
    macos:
      xcode: &quot;9.0&quot;
    working_directory: /Users/distiller/project
    environment:
      FL_OUTPUT_DIR: output
      FASTLANE_LANE: test
    shell: /bin/bash --login -o pipefail
    steps:
      - checkout
      - restore_cache:
          key: 1-gems-{{ checksum &quot;Gemfile.lock&quot; }}
      - run: bundle check || bundle install --path vendor/bundle
      - save_cache:
          key: 1-gems-{{ checksum &quot;Gemfile.lock&quot; }}
          paths:
            - vendor/bundle
      - run:
          name: fastlane
          command: bundle exec fastlane $FASTLANE_LANE
      - store_artifacts:
          path: output
      - store_test_results:
          path: output/scan
</code></pre>

<p>This will do the following:
<em> Create and use a Ruby gems cache.
</em> Run the test lane on all pushes.
* Collect Junit test results and store log output in the Artifacts tab.</p>
<p>Check out <a href="https://circleci.com/docs/2.0/testing-ios/#example-configuration-for-using-fastlane-on-circleci">the CircleCI iOS
doc</a>
for more detailed examples of using fastlane on CircleCI.</p>
<h1 id="travis-integration"><a name="user-content-travis-integration" href="#travis-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Travis Integration</h1>
<p>Update your <code>.travis.yml</code> to look like this:</p>
<pre><code class="yml">language: objective-c
osx_image: xcode8.3
install:
  - bundle install
script:
  - fastlane beta
</code></pre>

<p>The above config files assume you have a <code>Gemfile</code> set up, if you don't have one yet, make sure to follow our <a href="https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile">Gemfile guide</a> and run <code>bundle update</code> to make sure you're using the most recent <em>fastlane</em> release.</p>
<p>Replace <code>beta</code> with the lane you want to run for your setup. If you want to build, sign and distribute builds from Travis, you'll need to add one more action to your <code>Fastfile</code>, as by default, the Travis keychain is locked.</p>
<p>At the top of your <code>Fastfile</code>, add</p>
<pre><code class="ruby">setup_travis
</code></pre>

<p>which will setup the keychain to work well with <em>match</em> and <em>gym</em>. This action will also enable the <code>readonly</code> mode for <em>match</em>, so your CI doesn't create new certificates or provisioning profiles.</p>
<h1 id="bamboo-integration"><a name="user-content-bamboo-integration" href="#bamboo-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Bamboo Integration</h1>
<h2 id="repository-setup"><a name="user-content-repository-setup" href="#repository-setup" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Repository setup</h2>
<p>In bamboo under <strong>Linked Repositories</strong> (where you configure your git repo) under <strong>Advanced Settings</strong> is an option called <strong>Exclude changesets</strong></p>
<p>This dialog will allow you to enter a regular expression that if a commit matches, a build will not be triggered.</p>
<p>For example, if your <code>Fastfile</code> is configured to make a commit message in the style of</p>
<pre><code class="no-highlight">Build Version bump by fastlane to Version [0.3] Build [8]
</code></pre>

<p>Then you could use the following regex to ignore these commits</p>
<pre><code class="no-highlight">^.*Build Version bump by fastlane.*$
</code></pre>

<h2 id="setting-repository-remote"><a name="user-content-setting-repository-remote" href="#setting-repository-remote" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Setting repository remote</h2>
<p>By default bamboo will do an anonymous shallow clone of the repo.  This will not preserve the  <code>git remote</code> information nor the list of tags.  If you are using bamboo to create commits you may want to use a code block similar to the following:</p>
<pre><code class="ruby"># In prep for eventually committing a version/build bump - set the git params
sh('git config user.name &quot;&lt;COMMITTER USERNAME&gt;&quot;')
sh('git config user.email &lt;COMITTER EMAIL&gt;')

# Bamboo does an anonymous checkout so in order to update the build versions must set the git repo URL
git_remote_cmd = 'git remote set-url origin ' + ENV['bamboo_repository_git_repositoryUrl']
sh(git_remote_cmd)
</code></pre>

<h2 id="speeding-up-build-times-with-carthage"><a name="user-content-speeding-up-build-times-with-carthage" href="#speeding-up-build-times-with-carthage" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Speeding up build times with carthage</h2>
<p>Carthage is a wonderful dependency manager but once you are start using a large number of frameworks, things can start to slow down, especially if your CI server has to run <code>carthage</code> EVERY time you check in a small line of code.</p>
<p>One way to make build times faster is to break your work up into two separate build plans (<em>this can get even more funky if you start having multiple branches</em>)</p>
<p>The general idea is to make a build plan: <strong>Project - Artifacts</strong> that builds the <code>Carthage</code> directory and stores it as a shared artifact.  Then you create a second build plan <strong>Project - Fastlane</strong> that pulls down the <code>Carthage</code> directory and runs <em>fastlane</em>.</p>
<h3 id="artifact-plan"><a name="user-content-artifact-plan" href="#artifact-plan" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Artifact Plan</h3>
<p>Use a simple setup to create this build plan. First off you want to make sure this plan is manually triggered only - because you only need to run it whenever the <code>Cartfile</code> changes as opposed to after ever single commit.  It could also be on a nightly build perhaps if you desire.</p>
<h4 id="stages-jobs-tasks"><a name="user-content-stages-jobs-tasks" href="#stages-jobs-tasks" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Stages / Jobs / Tasks</h4>
<p>This plan consists of 1 Job, 1 Stage and 2 Tasks</p>
<ul>
<li>Task 1: <strong>Source Code Checkout</strong></li>
<li>Task 2: <strong>Script</strong> (<code>carthage update</code>)</li>
</ul>
<h4 id="artifact-definitions"><a name="user-content-artifact-definitions" href="#artifact-definitions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Artifact definitions</h4>
<p>Create a shared artifact with the following info:</p>
<ul>
<li><strong>Name:</strong> CarthageFolder</li>
<li><strong>Location:</strong> (leave blank)</li>
<li><strong>Copy Pattern:</strong> Carthage/Build/**</li>
</ul>
<p><em>Optional</em>: You may want to automatically make the <strong>fastlane plan</strong> trigger whenever this plan is built</p>
<h3 id="fastlane-plan"><em>fastlane</em> plan</h3>
<p>When configuring <em>fastlane</em> to run in this setup you need to make sure that you are not calling either:</p>
<pre><code class="ruby">reset_git_repo(force: true)
</code></pre>

<p>or</p>
<pre><code class="ruby">ensure_git_status_clean
</code></pre>

<p>as these calls will either fail the build or delete the <code>Carthage</code> directory.  Additionally you want to remove any <code>carthage</code> tasks from inside your <code>Fastfile</code> as <code>carthage</code> is now happening externally to the build.</p>
<h4 id="build-plan-setup"><a name="user-content-build-plan-setup" href="#build-plan-setup" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Build plan setup</h4>
<p>What this build plan does is it checks out the source code, then it downloads the entire <code>Carthage/Build/</code> directory into your local project - which is exactly what would be created from <code>carthage bootstrap</code> and then it runs <em>fastlane</em></p>
<ul>
<li>Task 1: <strong>Source Code Checkout</strong></li>
<li>Task 2: <strong>Artifact Download</strong></li>
<li>Task 3: <strong>fastlane</strong></li>
</ul>
<h1 id="gitlab-ci-integration"><a name="user-content-gitlab-ci-integration" href="#gitlab-ci-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>GitLab CI Integration</h1>
<p>Use <a href="https://gitlab.com/gitlab-org/gitlab-runner">GitLab Runner</a> running on a macOS machine
to build using fastlane.</p>
<h2 id="repository-setup_1"><a name="user-content-repository-setup_1" href="#repository-setup_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Repository setup</h2>
<p>First create a <code>Gemfile</code> in the root of your project with the following content:</p>
<pre><code class="ruby">source &quot;https://rubygems.org&quot;

gem &quot;fastlane&quot;
</code></pre>

<p>Add a <code>.gitlab-ci.yml</code> file to trigger <em>fastlane</em>.</p>
<pre><code class="yml">stages:
  - unit_tests
  - test_flight

variables:
  LC_ALL: &quot;en_US.UTF-8&quot;
  LANG: &quot;en_US.UTF-8&quot;

before_script:
  - gem install bundler
  - bundle install

unit_tests:
  dependencies: []
  stage: unit_tests
  artifacts:
    paths:
      - fastlane/screenshots
      - fastlane/logs
  script:
    - fastlane tests
  tags:
    - ios

test_flight_build:
  dependencies: []
  stage: test_flight
  artifacts:
    paths:
      - fastlane/screenshots
      - fastlane/logs
  script:
    - fastlane beta
  tags:
    - ios
  only:
     - /^release-.*$/
     - master
</code></pre>

<p>See <a href="https://docs.gitlab.com/ce/ci/yaml/README.html">the <code>.gitlab-ci.yml</code> documentation</a>
for more information on how this file works.</p>
<h2 id="setting-up-the-lanes"><a name="user-content-setting-up-the-lanes" href="#setting-up-the-lanes" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Setting up the lanes</h2>
<p>You should have a lane - in this example called <code>beta</code> - which should do the usual, <em>match</em>, <em>gym</em>, <em>pilot</em>, to distribute an updated Test Flight version, and one lane <code>tests</code> which calls <em>scan</em> to run UI Tests.</p>
<h2 id="auto-incremented-build-number"><a name="user-content-auto-incremented-build-number" href="#auto-incremented-build-number" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Auto-incremented build number.</h2>
<p>To get an auto-incremented build number you can use something like the following lane:</p>
<pre><code class="ruby">lane :increment_build_number do
  increment_build_number(build_number: ENV['CI_BUILD_ID'])
end
</code></pre>

<p>Then the GitLab CI build ID (which iterates on each build) will be used.</p>
<h1 id="visual-studio-team-services"><a name="user-content-visual-studio-team-services" href="#visual-studio-team-services" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Visual Studio Team Services</h1>
<p>Microsoft Visual Studio Team Services (VSTS) and Team Foundation Server (TFS) use <em>fastlane</em> in their <a href="https://marketplace.visualstudio.com/items?itemName=ms-vsclient.app-store">Apple App Store</a> extension.</p>
<h2 id="getting-started"><a name="user-content-getting-started" href="#getting-started" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Getting Started</h2>
<p>Once you have created or retrieved credentials for your App Store account, then perform the following steps to automate releasing updates from a VSTS build or release definition:</p>
<ol>
<li>Install the App Store extension from the VSTS Marketplace</li>
<li>Go to your VSTS or TFS project, click on the <strong>Build</strong> tab, and create a new build definition (the "+" icon) that is hooked up to your project's appropriate source repo</li>
<li>Click <strong>Add build step...</strong> and select the necessary tasks to generate your release assets (e.g. Gulp, Cordova Build)</li>
<li>Click <strong>Add build step...</strong> and select <strong>App Store Release</strong> from the <strong>Deploy</strong> category</li>
<li>Configure the <strong>App Store Release</strong> task with the desired authentication method, the generated IPA file path, and the desired release track.</li>
</ol>
<p>Now when you build, your app will automatically be published to <em>App Store Connect</em>!</p>
<h2 id="configuring-fastlane-versions"><a name="user-content-configuring-fastlane-versions" href="#configuring-fastlane-versions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Configuring <em>fastlane</em> versions</h2>
<p>The extension can be configured to install the latest version of <em>fastlane</em> or a specific version of <em>fastlane</em>:</p>
<ol>
<li>In the Build for your project, click on the <strong>Apple App Store</strong> task (supported in both <code>Apple App Store Release</code> and <code>Apple App Store Promote</code>), go to the <strong>Advanced</strong> section of the Task, click <strong>Install fastlane</strong></li>
<li>Optionally, select <strong>Specific Version</strong> from <code>fastlane version</code>, and enter a specific version of <em>fastlane</em></li>
</ol>
<h2 id="more-information"><a name="user-content-more-information" href="#more-information" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>More Information</h2>
<p>For more documentation, see the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vsclient.app-store">Apple App Store</a> in the Visual Studio Team Server marketplace.</p>
<h1 id="nevercode-integration"><a name="user-content-nevercode-integration" href="#nevercode-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Nevercode Integration</h1>
<p>With <a href="https://nevercode.io">Nevercode</a> you can set up automated builds for your Android and iOS application using <em>fastlane</em>. You only need a <a href="https://docs.fastlane.tools/#fastlane"><code>Fastfile</code></a> in your repository to get started.</p>
<h2 id="specify-app-repository"><a name="user-content-specify-app-repository" href="#specify-app-repository" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Specify app repository</h2>
<ol>
<li>Click <strong>Add a new app</strong> on Nevercode dashboard.</li>
<li>Choose whether to add your application via supported providers using OAuth or add it manually using the other available <a href="https://developer.nevercode.io/docs/authenticating-repository-access">authentication methods</a>.</li>
</ol>
<h2 id="define-the-lane-to-be-built"><a name="user-content-define-the-lane-to-be-built" href="#define-the-lane-to-be-built" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Define the lane to be built</h2>
<p>After specifying app repository, Nevercode takes a first look at it by listing the <code>branches</code> in this repository. The next step for you is to select the branch you want Nevercode to scan for projects.</p>
<ol>
<li>Select a <code>branch</code> from the dropdown that Nevercode should scan. <strong>Note</strong> that you can change the branch later if needed.</li>
<li>Click <strong>Scan branch</strong>. 
Nevercode scans the repository from the specified branch. This includes cloning the repository, looking up the available <code>Fastfiles</code> and listing the pre-configured <code>lanes</code>. All this can be monitored real-time from your browser via the live log window.</li>
<li>Once scanning the branch has finished, choose the <code>lane</code> which will be executed as the main build step by Nevercode.</li>
<li>Finalize the setup by checking the appropriate <a href="https://developer.nevercode.io/docs/build-configuration#section-general-build-settings">build options</a> and click <strong>Save and start build</strong>.</li>
</ol>
<h2 id="external-dependencies"><a name="user-content-external-dependencies" href="#external-dependencies" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>External dependencies</h2>
<p>Nevercode does not automatically install CocoaPods, Carthage or any other external dependencies for <em>fastlane</em> projects. Please use the <em>fastlane</em>'s built-in <a href="https://docs.fastlane.tools/actions/">actions</a>, such as <a href="https://docs.fastlane.tools/actions/cocoapods/"><code>cocoapods</code></a> and <a href="https://docs.fastlane.tools/actions/carthage/"><code>carthage</code></a>, to gain control of that.</p>
<h2 id="code-signing"><a name="user-content-code-signing" href="#code-signing" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Code signing</h2>
<p>To perform code signing on your iOS app, you can either follow the best practices laid out in <a href="https://docs.fastlane.tools/codesigning/getting-started/#using-match"><code>fastlane</code> docs</a>, or you could also make use of <a href="https://developer.nevercode.io/docs/code-signing">Nevercode's standard code signing methods</a>.</p>
<p>When invoking <a href="https://docs.fastlane.tools/actions/match/"><code>match</code></a> from the <code>Fastfile</code>, keep in mind that you need to <strong>grant access to the credentials repository</strong> and expose the <strong><em>match</em> passphrase</strong> during the build. Both can be securely achieved thanks to the well designed environment variable support of <em>fastlane</em> and Nevercode's support for several SSH keys for authentication.</p>
<p>In your app settings on Nevercode, navigate to the <strong>Environment</strong> tab to manage environment variables and files:</p>
<ul>
<li><em>match</em> passphrase can be defined as a <code>MATCH_PASSWORD</code> environment file — this will be automatically detected by <em>fastlane</em> and used to decrypt the credentials repository.</li>
<li>You can upload the SSH key for cloning the credentials repository as an environment file, i.e. <code>MATCH_SSH_KEY</code>. All environment files whose variable name has the suffix <code>_SSH_KEY</code> will be automatically added to the SSH agent and will be ready for use during the whole build process.</li>
</ul>
<h2 id="run-tests"><a name="user-content-run-tests" href="#run-tests" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Run tests</h2>
<h3 id="ios"><a name="user-content-ios" href="#ios" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>iOS</h3>
<p>Testing in Nevercode with <em>fastlane</em> for iOS is 100% automatic. By default, <a href="https://docs.fastlane.tools/actions/scan/"><code>scan</code></a> is used to invoke the test run, but you can easily swap it out for any other <code>lane</code> that you have configured for your test runs. Test results are automatically collected and you don't need to do anything to convert the results from one format to another or place them in a special location on the build machine.</p>
<h4 id="warning"><a name="user-content-warning" href="#warning" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Warning</h4>
<p>In case you wish to run tests as part of the main build step, we suggest that you use <a href="https://github.com/KrauseFx/trainer#use-with-fastlane">Trainer</a> to generate reliable JUnit results from the test run and put the results in a directory where we can discover them:</p>
<pre><code class="no-highlight">trainer(output_directory: ENV[&quot;NEVERCODE_XUNIT_RESULTS_DIR&quot;])
</code></pre>

<h3 id="android"><a name="user-content-android" href="#android" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Android</h3>
<p>Nevercode detects your <strong><em>fastlane</em> tests for Android</strong> automatically. However, tests are disabled by default and have to be enabled manually.</p>
<ol>
<li>In your app settings on Nevercode, navigate to the <strong>Test</strong> tab.</li>
<li>Click on <strong><em>fastlane</em> Gradle</strong> to expand it.</li>
<li>Select <strong>Enabled</strong> and type the <strong>lane name</strong> for tests as specified in your <code>Fastfile</code>.</li>
<li>If you would like to run the tests on Android emulator, make sure to select <strong>Require Android emulator</strong>.</li>
<li>Click <strong>Save</strong> to finish the setup. Your <em>fastlane</em> tests will be enabled and run each time you build your app.</li>
</ol>
<h2 id="publish-your-build-artifacts"><a name="user-content-publish-your-build-artifacts" href="#publish-your-build-artifacts" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Publish your build artifacts</h2>
<p>You can use either <code>fastlane</code> to take care of artifact distribution or choose from a number of <a href="https://developer.nevercode.io/docs/what-kind-of-build-distribution-services-does-nevercode-support">Nevercode's own integrations</a>.</p>
<h2 id="manage-build-versions"><a name="user-content-manage-build-versions" href="#manage-build-versions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Manage build versions</h2>
<p>To make your build version management easy, Nevercode exports the <code>NEVERCODE_BUILD_NUMBER</code> environment variable that you can use in your build script. For instance, you could make use of it within <a href="https://docs.fastlane.tools/actions/increment_version_number/"><code>increment_version_number</code></a> action to define a new version for each build. </p>
<h2 id="more-information_1"><a name="user-content-more-information_1" href="#more-information_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>More Information</h2>
<p>Check out <a href="https://developer.nevercode.io/docs">Nevercode documentation</a> for more. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../keys/" class="btn btn-neutral float-right" title="Keys">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../source-control/" class="btn btn-neutral" title="Source Control"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div class="fastlane" role="contentinfo">
    <p>
      <a href="https://github.com/fastlane/fastlane" target="_blank">
        <img src="/img/fastlane_text.png" width="200" />
      </a>
      <iframe src="https://ghbtns.com/github-btn.html?user=fastlane&repo=fastlane&type=watch&count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20" class="githubButton"></iframe>
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a> - Copyright &copy; 2018 <a href="https://fastlane.tools">fastlane</a>
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/fastlane/docs" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../source-control/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../keys/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
