<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="fastlane team">
  
  <title>Advanced - fastlane docs</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/breadcrumbs.css" rel="stylesheet">
  <link href="../css/code.css" rel="stylesheet">
  <link href="../css/fabric.css" rel="stylesheet">
  <link href="../css/fastlane.css" rel="stylesheet">
  <link href="../css/sidenav.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Advanced";
    var mkdocs_page_input_path = "advanced.md";
    var mkdocs_page_url = "/advanced/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-18658848-13', 'docs.fastlane.tools');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> fastlane docs</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="..">Home</a>
      
    </li>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Getting Started</span></li>
      
      
  
    <ul class="subnav">
      <li><span>iOS</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/ios/setup/">Setup</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/ios/running-tests/">Running Tests</a>
      
    </li>
  

      
      
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/ios/screenshots/">Screenshots</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/ios/beta-deployment/">Beta Deployment</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/ios/appstore-deployment/">App Store Deployment</a>
      
    </li>
  

      
    </ul>
  

      
      
  
    <ul class="subnav">
      <li><span>Android</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/android/setup/">Setup</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/android/running-tests/">Running Tests</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/android/screenshots/">Screenshots</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/android/beta-deployment/">Beta Deployment</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../getting-started/android/release-deployment/">Release Deployment</a>
      
    </li>
  

      
    </ul>
  

      
    </ul>
  
<li>
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../actions/">Actions</a>
      
    </li>
  
<li>
          
            <li>
  
<li>
          
            <li>
  
    <li class="toctree-l1 ">
      <a class="" href="../faqs/">FAQs</a>
      
    </li>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Codesigning</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../codesigning/getting-started/">Getting Started</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../codesigning/xcode-project/">Xcode Project</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../codesigning/troubleshooting/">Troubleshooting</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../codesigning/common-issues/">Common Issues</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Plugins</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../plugins/available-plugins/">Available Plugins</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../plugins/create-plugin/">Create Your Own Plugin</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../plugins/plugins-troubleshooting/">Plugins Troubleshooting</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <ul class="subnav">
      <li><span>Best Practices</span></li>
      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../best-practices/source-control/">Source Control</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../best-practices/continuous-integration/">Continuous Integration</a>
      
    </li>
  

      
      
  
    <li class="toctree-l1 ">
      <a class="" href="../best-practices/keys/">Keys</a>
      
    </li>
  

      
    </ul>
  
<li>
          
            <li>
  
    <li class="toctree-l1 current">
      <a class="current" href="./">Advanced</a>
      
      <ul>
        
          
        
          
          <li class="toctree-l3"><a href="#passing-parameters">Passing Parameters</a></li>
          
        
          
          <li class="toctree-l3"><a href="#switching-lanes">Switching lanes</a></li>
          
        
          
          <li class="toctree-l3"><a href="#output-environment-variables">Output environment variables</a></li>
          
        
          
          <li class="toctree-l3"><a href="#interacting-with-the-user">Interacting with the user</a></li>
          
        
          
          <li class="toctree-l3"><a href="#run-actions-directly">Run actions directly</a></li>
          
        
          
          <li class="toctree-l3"><a href="#shell-values">Shell values</a></li>
          
        
          
          <li class="toctree-l3"><a href="#priorities-of-parameters-and-options">Priorities of parameters and options</a></li>
          
        
          
          <li class="toctree-l3"><a href="#importing-another-fastfile">Importing another Fastfile</a></li>
          
        
          
          <li class="toctree-l3"><a href="#using-fastlane_require">Using fastlane_require</a></li>
          
        
          
          <li class="toctree-l3"><a href="#environment-variables">Environment Variables</a></li>
          
        
          
          <li class="toctree-l3"><a href="#lane-properties">Lane Properties</a></li>
          
        
          
          <li class="toctree-l3"><a href="#lane-context">Lane Context</a></li>
          
        
          
          <li class="toctree-l3"><a href="#private-lanes">Private lanes</a></li>
          
        
          
          <li class="toctree-l3"><a href="#load-own-actions-from-external-folder">Load own actions from external folder</a></li>
          
        
          
          <li class="toctree-l3"><a href="#skip-update-check-when-launching-fastlane">Skip update check when launching fastlane</a></li>
          
        
          
          <li class="toctree-l3"><a href="#hide-changelog-information-at-the-end-of-running-fastlane">Hide changelog information at the end of running fastlane</a></li>
          
        
          
          <li class="toctree-l3"><a href="#adding-credentials">Adding Credentials</a></li>
          
        
          
          <li class="toctree-l3"><a href="#control-configuration-by-lane-and-by-platform">Control configuration by lane and by platform</a></li>
          
        
          
          <li class="toctree-l3"><a href="#manually-manage-the-fastlane-match-repo">Manually Manage the fastlane match Repo</a></li>
          
        
          
          <li class="toctree-l3"><a href="#directory-behavior">Directory behavior</a></li>
          
        
          
          <li class="toctree-l3"><a href="#appfile">Appfile</a></li>
          
        
          
          <li class="toctree-l3"><a href="#building-actions">Building Actions</a></li>
          
        
      </ul>
      
    </li>
  
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">fastlane docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Advanced</li>

    
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/fastlane/docs/edit/master/docs/advanced.md" class="icon icon-github" target="_blank">
            Edit on GitHub
          </a>
        
      </li>
    
    <li class="wy-breadcrumbs-aside">
      <input type="text" name="q" placeholder="Search docs" />
    </li>
  </ul>
  <hr/>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<!-- at the end of the BODY -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    apiKey: 'c651753b86f5f8a00f8f2e9e9ca95865',
    indexName: 'fastlane',
    inputSelector: 'body > div.wy-grid-for-nav > section > div > div > div:nth-child(1) > ul > li.wy-breadcrumbs-aside > input[type="text"]',
    debug: false
});
</script>
          <div role="main">
            <div class="section">
              
                <style type="text/css">
  .fastlane-setup {
    border-left: .4rem solid #00b0ff;
    border-bottom: .1rem solid rgba(0,176,255,.1);
    background-color: rgba(0,176,255,.1);
    padding: 15px;
    margin-bottom: 20px;
    font-weight: 200;
  }
  .fastlane-setup-wrapper {
    background-color: rgba(0,176,255,.05);
  }
  .fastlane-setup-wrapper[open] {
    padding-bottom: 1px;
  }
  .fastlane-setup-header {
    font-size: 20px;
    font-weight: 500;
  }
  .fastlane-setup-more-details {
    font-size: 18px;
    font-weight: 350;
  }
</style>

<p><details class="fastlane-setup-wrapper">
  <summary class="fastlane-setup">New to fastlane? Click here to open the installation &amp; setup instructions first</summary></p>
<p class="fastlane-setup-header">1) Install the latest Xcode command line tools</p>

<pre><code class="no-highlight">xcode-select --install
</code></pre>

<p class="fastlane-setup-header">2) Install <i>fastlane</i></p>

<pre><code class="sh"># Using RubyGems
sudo gem install fastlane -NV

# Alternatively using Homebrew
brew cask install fastlane
</code></pre>

<p class="fastlane-setup-header">3) Navigate to your project and run</p>

<pre><code class="no-highlight">fastlane init
</code></pre>

<p class="fastlane-setup-more-details"><a href="/getting-started/ios/setup/">More Details</a></p>

<p></details></p>
<h1 id="advanced-fastlane"><a name="user-content-advanced-fastlane" href="#advanced-fastlane" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Advanced fastlane</h1>
<h1 id="passing-parameters"><a name="user-content-passing-parameters" href="#passing-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Passing Parameters</h1>
<p>To pass parameters from the command line to your lane, use the following syntax:</p>
<pre><code class="no-highlight">fastlane [lane] key:value key2:value2

fastlane deploy submit:false build_number:24
</code></pre>

<p>To access those values, change your lane declaration to also include <code>|options|</code></p>
<pre><code class="ruby">before_all do |lane, options|
  # ...
end

before_each do |lane, options|
  # ...
end

lane :deploy do |options|
  # ...
  if options[:submit]
    # Only when submit is true
  end
  # ...
  increment_build_number(build_number: options[:build_number])
  # ...
end

after_all do |lane, options|
  # ...
end

after_each do |lane, options|
  # ...
end

error do |lane, exception, options|
  if options[:debug]
    puts &quot;Hi :)&quot;
  end
end
</code></pre>

<h1 id="switching-lanes"><a name="user-content-switching-lanes" href="#switching-lanes" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Switching lanes</h1>
<p>To switch lanes while executing a lane, use the following code:</p>
<pre><code class="ruby">lane :deploy do |options|
  # ...
  build(release: true) # that's the important bit
  hockey
  # ...
end

lane :staging do |options|
  # ...
  build # it also works when you don't pass parameters
  hockey
  # ...
end

lane :build do |options|
  scheme = (options[:release] ? &quot;Release&quot; : &quot;Staging&quot;)
  ipa(scheme: scheme)
end
</code></pre>

<p><em>fastlane</em> takes care of all the magic for you. You can call lanes of the same platform or a general lane outside of the <code>platform</code> definition.</p>
<p>Passing parameters is optional.</p>
<h2 id="returning-values"><a name="user-content-returning-values" href="#returning-values" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Returning values</h2>
<p>Additionally, you can retrieve the return value. In Ruby, the last line of the <code>lane</code> definition is the return value. Here is an example:</p>
<pre><code class="ruby">lane :deploy do |options|
  value = calculate(value: 3)
  puts value # =&gt; 5
end

lane :calculate do |options|
  # ...
  2 + options[:value] # the last line will always be the return value
end
</code></pre>

<h2 id="stop-executing-a-lane-early"><a name="user-content-stop-executing-a-lane-early" href="#stop-executing-a-lane-early" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Stop executing a lane early</h2>
<p>The <code>next</code> keyword can be used to stop executing a <code>lane</code> before it reaches the end.</p>
<pre><code class="ruby">lane :build do |options|
  if cached_build_available?
    UI.important 'Skipping build because a cached build is available!'
    next # skip doing the rest of this lane
  end
  match
  gym
end

private_lane :cached_build_available? do |options|
  # ...
  true
end
</code></pre>

<p>When <code>next</code> is used during a <code>lane</code> switch, control returns to the previous <code>lane</code> that was executing.</p>
<pre><code class="ruby">lane :first_lane do |options|
  puts &quot;If you run: `fastlane first_lane`&quot;
  puts &quot;You'll see this!&quot;
  second_lane
  puts &quot;As well as this!&quot;
end

private_lane :second_lane do |options|
  next
  puts &quot;This won't be shown&quot;
end
</code></pre>

<p>When you stop executing a lane early with <code>next</code>, any <code>after_each</code> and <code>after_all</code> blocks you have will still trigger as usual :+1:</p>
<h2 id="before_each-and-after_each-blocks"><code>before_each</code> and <code>after_each</code> blocks</h2>
<p><code>before_each</code> blocks are called before any lane is called. This would include being called before each lane you've switched to.</p>
<pre><code class="ruby">before_each do |lane, options|
  # ...
end
</code></pre>

<p><code>after_each</code> blocks are called after any lane is called. This would include being called after each lane you've switched to.
Just like <code>after_all</code>, <code>after_each</code> is not called if an error occurs. The <code>error</code> block should be used in this case.</p>
<pre><code class="ruby">after_each do |lane, options|
  # ...
end
</code></pre>

<p>e.g. With this scenario, <code>before_each</code> and <code>after_each</code> would be called 4 times: before the <code>deploy</code> lane, before the switch to <code>archive</code>, <code>sign</code>, and <code>upload</code>, and after each of these lanes as well.</p>
<pre><code class="ruby">lane :deploy do
  archive
  sign
  upload
end

lane :archive do
  # ...
end

lane :sign do
  # ...
end

lane :upload do
  # ...
end
</code></pre>

<h1 id="output-environment-variables"><a name="user-content-output-environment-variables" href="#output-environment-variables" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Output environment variables</h1>
<ul>
<li>To hide timestamps in each row, set the <code>FASTLANE_HIDE_TIMESTAMP</code> environment variable to true.</li>
<li>To disable output formatting, set the <code>FASTLANE_DISABLE_OUTPUT_FORMAT</code> environment variable to true.</li>
</ul>
<h1 id="interacting-with-the-user"><a name="user-content-interacting-with-the-user" href="#interacting-with-the-user" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Interacting with the user</h1>
<p>Instead of using <code>puts</code>, <code>raise</code> and <code>gets</code>, please use the helper class <code>UI</code> across all fastlane tools:</p>
<pre><code class="ruby">UI.message &quot;Neutral message (usually white)&quot;
UI.success &quot;Successfully finished processing (usually green)&quot;
UI.error &quot;Wahaha, what's going on here! (usually red)&quot;
UI.important &quot;Make sure to use Windows (usually yellow)&quot;

UI.header &quot;Inputs&quot; # a big box

name = UI.input(&quot;What's your name? &quot;)
if UI.confirm(&quot;Are you '#{name}'?&quot;)
  UI.success &quot;Oh yeah&quot;
else
  UI.error &quot;Wups, invalid&quot;
end

UI.password(&quot;Your password please: &quot;) # password inputs are hidden

###### A &quot;Dropdown&quot; for the user
project = UI.select(&quot;Select your project: &quot;, [&quot;Test Project&quot;, &quot;Test Workspace&quot;])

UI.success(&quot;Okay #{name}, you selected '#{project}'&quot;)

###### To run a command use
FastlaneCore::CommandExecutor.execute(command: &quot;ls&quot;,
                                    print_all: true,
                                        error: proc do |error_output|
                                          # handle error here
                                        end)

###### or if you just want to receive a simple value use this only if the command doesn't take long
diff = Helper.backticks(&quot;git diff&quot;)

###### fastlane &quot;crash&quot; because of a user error everything that is caused by the user and is not unexpected
UI.user_error!(&quot;You don't have a project in the current directory&quot;)

###### an actual crash when something unexpected happened
UI.crash!(&quot;Network timeout&quot;)

###### a deprecation message
UI.deprecated(&quot;The '--key' parameter is deprecated&quot;)
</code></pre>

<h1 id="run-actions-directly"><a name="user-content-run-actions-directly" href="#run-actions-directly" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Run actions directly</h1>
<p>If you just want to try an action without adding them to your <code>Fastfile</code> yet, you can use</p>
<pre><code class="no-highlight">fastlane run notification message:&quot;My Text&quot; title:&quot;The Title&quot;
</code></pre>

<p>To get the available options for any action run <code>fastlane action [action_name]</code>. You might not be able to set some kind of parameters using this method.</p>
<h1 id="shell-values"><a name="user-content-shell-values" href="#shell-values" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Shell values</h1>
<p>You can get value from shell commands:</p>
<pre><code class="ruby">output = sh(&quot;pod update&quot;)
</code></pre>

<h1 id="priorities-of-parameters-and-options"><a name="user-content-priorities-of-parameters-and-options" href="#priorities-of-parameters-and-options" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Priorities of parameters and options</h1>
<p>The order in which <em>fastlane</em> tools take their values from</p>
<ol>
<li>CLI parameter (e.g. <code>gym --scheme Example</code>) or Fastfile (e.g. <code>gym(scheme: 'Example')</code>)</li>
<li>Environment variable (e.g. <code>GYM_SCHEME</code>)</li>
<li>Tool specific config file (e.g. <code>Gymfile</code> containing <code>scheme 'Example'</code>)</li>
<li>Default value (which might be taken from the <code>Appfile</code>, e.g. <code>app_identifier</code> from the <code>Appfile</code>)</li>
<li>If this value is required, you'll be asked for it (e.g. you have multiple schemes, you'll be asked for it)</li>
</ol>
<h1 id="importing-another-fastfile"><a name="user-content-importing-another-fastfile" href="#importing-another-fastfile" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Importing another Fastfile</h1>
<p>Within your <code>Fastfile</code> you can import another <code>Fastfile</code> using 2 methods:</p>
<h2 id="import"><code>import</code></h2>
<p>Import a <code>Fastfile</code> from a local path</p>
<pre><code class="ruby">import &quot;../GeneralFastfile&quot;

override_lane :from_general do
  # ...
end
</code></pre>

<h2 id="import_from_git"><code>import_from_git</code></h2>
<p>Import from another git repository, which you can use to have one git repo with a default <code>Fastfile</code> for all your project</p>
<pre><code class="ruby">import_from_git(url: 'https://github.com/fastlane/fastlane')
# or
import_from_git(url: 'git@github.com:MyAwesomeRepo/MyAwesomeFastlaneStandardSetup.git',
               path: 'fastlane/Fastfile')

lane :new_main_lane do
  # ...
end
</code></pre>

<p>This will also automatically import all the local actions from this repo.</p>
<h2 id="note"><a name="user-content-note" href="#note" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Note</h2>
<p>You should import the other <code>Fastfile</code> on the top above your lane declarations. When defining a new lane <em>fastlane</em> will make sure to not run into any name conflicts. If you want to overwrite an existing lane (from the imported one), use the <code>override_lane</code> keyword.</p>
<h1 id="using-fastlane_require"><a name="user-content-using-fastlane_require" href="#using-fastlane_require" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Using fastlane_require</h1>
<p>If you're using a third party gem, it is recommended to use <code>fastlane_require</code> in your <code>Fastfile</code> instead of <code>require</code>. <code>fastlane_require</code> will:</p>
<ul>
<li>Verify the gem is installed</li>
<li>Show installation instructions if not installed</li>
<li>Require the gem (like <code>require</code> does)</li>
</ul>
<h2 id="example"><a name="user-content-example" href="#example" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Example</h2>
<pre><code class="rb">fastlane_require 'hike'

lane :release do
  # Do stuff with hike
end
</code></pre>

<h1 id="environment-variables"><a name="user-content-environment-variables" href="#environment-variables" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Environment Variables</h1>
<p>You can define environment variables in a <code>.env</code> or <code>.env.default</code> file in the same directory as your <code>Fastfile</code>. Environment variables are loaded using <a href="https://github.com/bkeepers/dotenv">dotenv</a>. Here's an example:</p>
<pre><code class="no-highlight">WORKSPACE=YourApp.xcworkspace
HOCKEYAPP_API_TOKEN=your-hockey-api-token
</code></pre>

<p><em>fastlane</em> also has a <code>--env</code> option that allows loading of environment specific <code>dotenv</code> files. <code>.env</code> and <code>.env.default</code> will be loaded before environment specific <code>dotenv</code> files are loaded. The naming convention for environment specific <code>dotenv</code> files is <code>.env.&lt;environment&gt;</code></p>
<p>For example, <code>fastlane &lt;lane-name&gt; --env development</code> will load <code>.env</code>, <code>.env.default</code>, and <code>.env.development</code></p>
<p>Alternatively, as environment variables are not a fastlane specific thing, you can also use standard methods to set them:</p>
<pre><code>DELIVER_USER=&quot;felix@krausefx.com&quot; fastlane test
</code></pre>

<p>or</p>
<pre><code>export DELIVER_USER=&quot;felix@krausefx.com&quot;;
fastlane test
</code></pre>

<p>Although it kind of defeats the purpose of using them in the first place (not to have their content in any files), you can also set them in your <code>Fastfile</code>:</p>
<pre><code>ENV[&quot;DELIVER_USER&quot;] = &quot;felix@krausefx.com&quot;
</code></pre>

<h1 id="lane-properties"><a name="user-content-lane-properties" href="#lane-properties" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Lane Properties</h1>
<p>It can be useful to dynamically access properties of the current lane. These are available in <code>lane_context</code>:</p>
<pre><code class="ruby">lane_context[SharedValues::PLATFORM_NAME]        # Platform name, e.g. `ios`, `android` or empty (for root level lanes)
lane_context[SharedValues::LANE_NAME]            # The name of the current lane preceded by the platform name (stays the same when switching lanes)
lane_context[SharedValues::DEFAULT_PLATFORM]     # Default platform
</code></pre>

<p>and environment variables:</p>
<pre><code class="ruby">ENV[&quot;FASTLANE_PLATFORM_NAME&quot;]
ENV[&quot;FASTLANE_LANE_NAME&quot;]
</code></pre>

<h1 id="lane-context"><a name="user-content-lane-context" href="#lane-context" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Lane Context</h1>
<p>The different actions can <em>communicate</em> with each other using a shared hash. You can access this in your lanes with the following code:</p>
<pre><code class="ruby">lane_context[SharedValues::VARIABLE_NAME_HERE]
</code></pre>

<p>Here are some examples:</p>
<pre><code class="ruby">lane_context[SharedValues::BUILD_NUMBER]                # Generated by `increment_build_number`
lane_context[SharedValues::VERSION_NUMBER]              # Generated by `increment_version_number`
lane_context[SharedValues::SNAPSHOT_SCREENSHOTS_PATH]   # Generated by _snapshot_
lane_context[SharedValues::PRODUCE_APPLE_ID]            # The Apple ID of the newly created app
lane_context[SharedValues::IPA_OUTPUT_PATH]             # Generated by _gym_
lane_context[SharedValues::DSYM_OUTPUT_PATH]            # Generated by _gym_
lane_context[SharedValues::SIGH_PROFILE_PATH]           # Generated by _sigh_
lane_context[SharedValues::SIGH_UDID]                   # The UDID of the generated provisioning profile
lane_context[SharedValues::HOCKEY_DOWNLOAD_LINK]        # Generated by `hockey`
lane_context[SharedValues::GRADLE_APK_OUTPUT_PATH]      # Generated by `gradle`
lane_context[SharedValues::GRADLE_ALL_APK_OUTPUT_PATHS] # Generated by `gradle`
lane_context[SharedValues::GRADLE_FLAVOR]               # Generated by `gradle`
lane_context[SharedValues::GRADLE_BUILD_TYPE]           # Generated by `gradle`
</code></pre>

<p>To get information about available lane variables, run <code>fastlane action [action_name]</code>.</p>
<h1 id="private-lanes"><a name="user-content-private-lanes" href="#private-lanes" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Private lanes</h1>
<p>Sometimes you might have a lane that is used from different lanes, for example:</p>
<pre><code class="ruby">lane :production do
  # ...
  build(release: true)
  appstore # Deploy to the AppStore
  # ...
end

lane :beta do
  # ...
  build(release: false)
  crashlytics # Distribute to testers
  # ...
end

lane :build do |options|
  # ...
  ipa
  # ...
end
</code></pre>

<p>It probably doesn't make sense to execute the <code>build</code> lane directly using <code>fastlane build</code>. You can hide this lane using</p>
<pre><code class="ruby">private_lane :build do |options|
  # ...
end
</code></pre>

<p>This will hide the lane from:</p>
<ul>
<li><code>fastlane lanes</code></li>
<li><code>fastlane list</code></li>
<li><code>fastlane docs</code></li>
</ul>
<p>And also, you can't call the private lane using <code>fastlane build</code>.</p>
<p>The resulting private lane can only be called from another lane using the lane switching technology.</p>
<h1 id="load-own-actions-from-external-folder"><a name="user-content-load-own-actions-from-external-folder" href="#load-own-actions-from-external-folder" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Load own actions from external folder</h1>
<p>Add this to the top of your <code>Fastfile</code>.</p>
<pre><code class="ruby">actions_path '../custom_actions_folder/'
</code></pre>

<h1 id="skip-update-check-when-launching-fastlane"><a name="user-content-skip-update-check-when-launching-fastlane" href="#skip-update-check-when-launching-fastlane" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Skip update check when launching <em>fastlane</em></h1>
<p>You can set the environment variable <code>FASTLANE_SKIP_UPDATE_CHECK</code> to skip the update check.</p>
<h1 id="hide-changelog-information-at-the-end-of-running-fastlane"><a name="user-content-hide-changelog-information-at-the-end-of-running-fastlane" href="#hide-changelog-information-at-the-end-of-running-fastlane" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Hide changelog information at the end of running <em>fastlane</em></h1>
<p>You can set the environment variable <code>FASTLANE_HIDE_CHANGELOG</code> to hide the detailed changelog information when new <em>fastlane</em> versions are available.</p>
<h1 id="adding-credentials"><a name="user-content-adding-credentials" href="#adding-credentials" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Adding Credentials</h1>
<p>You can add credentials for use by <em>fastlane</em> to your keychain using the <a href="https://github.com/fastlane/fastlane/tree/master/credentials_manager">CredentialsManager</a> command line interface. This is useful for situations like CI environments.</p>
<p><strong>Adding a Credential</strong></p>
<pre><code class="no-highlight">fastlane fastlane-credentials add --username felix@krausefx.com
Password: *********
Credential felix@krausefx.com:********* added to keychain.
</code></pre>

<p><strong>Removing a Credential</strong></p>
<pre><code class="no-highlight">fastlane fastlane-credentials remove --username felix@krausefx.com
password has been deleted.
</code></pre>

<h1 id="control-configuration-by-lane-and-by-platform"><a name="user-content-control-configuration-by-lane-and-by-platform" href="#control-configuration-by-lane-and-by-platform" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Control configuration by lane and by platform</h1>
<p>In general, configuration files take only the first value given for a particular configuration item. That means that for an <code>Appfile</code> like the following:</p>
<pre><code class="ruby">app_identifier &quot;com.used.id&quot;
app_identifier &quot;com.ignored.id&quot;
</code></pre>

<p>the <code>app_identfier</code> will be <code>"com.used.id"</code> and the second value will be ignored. The <code>for_lane</code> and <code>for_platform</code> configuration blocks provide a limited exception to this rule.</p>
<p>All configuration files (Appfile, Matchfile, Screengrabfile, etc.) can use <code>for_lane</code> and <code>for_platform</code> blocks to control (and override) configuration values for those circumstances.</p>
<p><code>for_lane</code> blocks will be called when the name of lane invoked on the command line matches the one specified by the block. So, given a <code>Screengrabfile</code> like:</p>
<pre><code class="ruby">locales ['en-US', 'fr-FR', 'ja-JP']

for_lane :screenshots_english_only do
  locales ['en-US']
end

for_lane :screenshots_french_only do
  locales ['fr-FR']
end
</code></pre>

<p><code>locales</code> will have the values <code>['en-US', 'fr-FR', 'ja-JP']</code> by default, but will only have one value when running the <code>fastlane screenshots_english_only</code> or <code>fastlane screenshots_french_only</code>.</p>
<p><code>for_platform</code> gives you similar control based on the platform for which you have invoked <em>fastlane</em>. So, for an <code>Appfile</code> configured like:</p>
<pre><code class="ruby">app_identifier &quot;com.default.id&quot;

for_lane :enterprise do
  app_identifier &quot;com.forlane.enterprise&quot;
end

for_platform :mac do
  app_identifier &quot;com.forplatform.mac&quot;

  for_lane :release do
    app_identifier &quot;com.forplatform.mac.forlane.release&quot;
  end
end
</code></pre>

<p>you can expect the <code>app_identifier</code> to equal <code>"com.forplatform.mac.forlane.release"</code> when invoking <code>fastlane mac release</code>.</p>
<h1 id="manually-manage-the-fastlane-match-repo"><a name="user-content-manually-manage-the-fastlane-match-repo" href="#manually-manage-the-fastlane-match-repo" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Manually Manage the fastlane match Repo</h1>
<p>Most users can benefit from <em>match</em>'s automatic management of the repo that stores certificates and provisioning profiles. From time to time, it may be necessary to manually change the files in this repo.</p>
<p>For example, <em>fastlane</em> requires admin access to the Apple Developer account to generate the appropriate files. If you are provided with an updated certificate or profile but do not have admin access, you can manually edit the repo.</p>
<blockquote>
<p><strong>Warning:</strong> Manually editing your <em>match</em> repo can introduce unexpected behavior and is not recommended. Proceed with caution.</p>
</blockquote>
<p><details>
<summary>Instructions</summary></p>
<h3 id="overview"><a name="user-content-overview" href="#overview" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Overview</h3>
<p>Because:</p>
<ol>
<li><em>fastlane</em> encrypts the repo, and</li>
<li><em>fastlane</em> doesn't support manual edits to the repo</li>
</ol>
<p>it's necessary to manually decrypt, then modify, then encrypt, the repo to make any changes.</p>
<blockquote>
<p>These instructions presuppose you already have <em>fastlane</em> <em>match</em> configured correctly.</p>
</blockquote>
<h3 id="decryption-instructions"><a name="user-content-decryption-instructions" href="#decryption-instructions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>🔓 Decryption Instructions</h3>
<p>The easiest way to decrypt the repo is to use the <em>fastlane</em> <em>match</em> <code>GitHelper</code> class. You can do this from an interactive Ruby console:</p>
<pre><code class="bash">$ bundle console
irb(main):001:0&gt;
</code></pre>

<p>Then, require <em>match</em> and set the appropriate parameters:</p>
<pre><code class="ruby">irb(main):001:0&gt; require 'match'
irb(main):002:0&gt; git_url = 'https://github.com/fastlane/example-certificate-repo'
=&gt; &quot;https://github.com/fastlane/example-certificate-repo&quot;
irb(main):003:0&gt; shallow_clone = false
=&gt; false
irb(main):004:0&gt; manual_password = 'example-password'
=&gt; &quot;example-password&quot;
</code></pre>

<p>Now call <code>GitHelper.clone</code>, which will clone and decrypt the repo for you. Assign the return value to <code>workspace</code>, which we'll need later when we re-encrypt:</p>
<pre><code class="ruby">irb(main):005:0&gt; workspace = Match::GitHelper.clone(git_url, shallow_clone, manual_password: manual_password)
[14:49:30]: Cloning remote git repo...
[14:49:31]: 🔓  Successfully decrypted certificates repo
=&gt; &quot;/var/folders/0j/29ytx6wx0fg86sznfb4mqdph0000gn/T/d20170314-14350-11hmdro&quot;
</code></pre>

<p>The above example checks out the <code>master</code> branch by default. A common <em>match</em> pattern is to create a separate branch per each developer team (the name of the branch being the team identifier). You can optionally pass in the branch name as a parameter to the <code>clone</code> method:</p>
<pre><code class="ruby">irb(main):005:0&gt; workspace = Match::GitHelper.clone(git_url, shallow_clone, manual_password: manual_password, branch: 'ABCDE12345')
</code></pre>

<p>The directory beginning with <code>/var/folders</code> contains the decrypted git repo. Modify it as needed.</p>
<p>If you are updating a <code>.p12</code> file, ensure it's exported from the keychain without a password, since <em>match</em> doesn't support importing private keys with a password.</p>
<blockquote>
<p><strong>Warning:</strong> Do <em>not</em> commit your changes. Allow <em>fastlane</em> to do that for you.</p>
</blockquote>
<p>Once your changes are made, we'll need to encrypt the repo and push it.</p>
<h3 id="encryption-instructions"><a name="user-content-encryption-instructions" href="#encryption-instructions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>🔒 Encryption Instructions</h3>
<p>In the Ruby console, call <code>GitHelper.commit_changes</code>, passing in the commit message you want. For example:</p>
<pre><code class="ruby">irb(main):006:0&gt; Match::GitHelper.commit_changes(workspace, &quot;remove password from p12 file&quot;, git_url)
</code></pre>

<p>Again, pass in the branch name if your changes are not on <code>master</code>:</p>
<pre><code class="ruby">irb(main):006:0&gt; Match::GitHelper.commit_changes(workspace, &quot;remove password from p12 file&quot;, git_url, 'ABCDE12345')
</code></pre>

<p>Your changes will be encrypted, committed, and pushed.</p>
<blockquote>
<p><strong>Note:</strong> If your keychain doesn't include the encryption passcode, you may be prompted for it. If so, just enter the same password you used to decrypt it.</p>
</blockquote>
<p></details></p>
<h1 id="directory-behavior"><a name="user-content-directory-behavior" href="#directory-behavior" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Directory behavior</h1>
<p><em>fastlane</em> was designed in a way that you can run <em>fastlane</em> from both the root directory of the project, and from the <code>./fastlane</code> sub-folder.</p>
<p>Take this example <code>Fastfile</code> on the path <code>fastlane/Fastfile</code></p>
<pre><code class="ruby">sh &quot;pwd&quot; # =&gt; &quot;[root]/fastlane&quot;
puts Dir.pwd # =&gt; &quot;[root]/fastlane&quot;

lane :something do
  sh &quot;pwd&quot; # =&gt; &quot;[root]/fastlane&quot;
  puts Dir.pwd # =&gt; &quot;[root]/fastlane&quot;

  my_action
end
</code></pre>

<p>The implementation of <code>my_action</code> looks like this:</p>
<pre><code class="ruby">def run(params)
  puts Dir.pwd # =&gt; &quot;[root]&quot;
end
</code></pre>

<p>Notice how every action and every plugin's code runs in the root of the project, while all user code from the <code>Fastfile</code> runs inside the <code>./fastlane</code> directory. This is important to consider when migrating existing code from your <code>Fastfile</code> into your own action or plugin. To change the directory manually you can use standard Ruby blocks:</p>
<pre><code class="ruby">Dir.chdir(&quot;..&quot;) do
  # code here runs in the parent directory
end
</code></pre>

<p>This behavior isn't great, and has been like this since the very early days of <em>fastlane</em>. As much as we'd like to change it, there is no good way to do so, without breaking thousands of production setups, so we decided to keep it as is for now.</p>
<h1 id="appfile"><a name="user-content-appfile" href="#appfile" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Appfile</h1>
<p>The <code>Appfile</code> stores useful information that are used across all <em>fastlane</em> tools like your <em>Apple ID</em> or the application <em>Bundle Identifier</em>, to deploy your lanes faster and tailored on your project needs.</p>
<p>The <code>Appfile</code> has to be inside your <code>./fastlane</code> directory.</p>
<p>By default an <code>Appfile</code> looks like:</p>
<pre><code class="ruby">app_identifier &quot;net.sunapps.1&quot; # The bundle identifier of your app
apple_id &quot;felix@krausefx.com&quot;  # Your Apple email address

# You can uncomment the lines below and add your own
# team selection in case you're in multiple teams
# team_name &quot;Felix Krause&quot;
# team_id &quot;Q2CBPJ58CA&quot;

# To select a team for App Store Connect use
# itc_team_name &quot;Company Name&quot;
# itc_team_id &quot;18742801&quot;
</code></pre>

<p>If you have different credentials for App Store Connect and the Apple Developer Portal use the following code:</p>
<pre><code class="ruby">app_identifier &quot;tools.fastlane.app&quot;       # The bundle identifier of your app

apple_dev_portal_id &quot;portal@company.com&quot;  # Apple Developer Account
itunes_connect_id &quot;tunes@company.com&quot;     # App Store Connect Account

team_id &quot;Q2CBPJ58CA&quot; # Developer Portal Team ID
itc_team_id &quot;18742801&quot; # App Store Connect Team ID
</code></pre>

<p>If your project has different bundle identifiers per environment (i.e. beta, app store), you can define that by using <code>for_platform</code> and/or <code>for_lane</code> block declaration.</p>
<pre><code class="ruby">app_identifier &quot;net.sunapps.1&quot;
apple_id &quot;felix@krausefx.com&quot;
team_id &quot;Q2CBPJ58CC&quot;

for_platform :ios do
  team_id '123' # for all iOS related things
  for_lane :test do
    app_identifier 'com.app.test'
  end
end
</code></pre>

<p>You only have to use <code>for_platform</code> if you're using <code>platform [platform_name] do</code> in your <code>Fastfile</code>.</p>
<p><em>fastlane</em> will always use the lane specific value if given, otherwise fall back to the value on the top of the file. Therefore, while driving the <code>:test</code> lane, this configuration is loaded:</p>
<pre><code class="ruby">app_identifier &quot;com.app.test&quot;
apple_id &quot;felix@krausefx.com&quot;
team_id &quot;123&quot;
</code></pre>

<h2 id="accessing-from-fastlane"><a name="user-content-accessing-from-fastlane" href="#accessing-from-fastlane" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Accessing from fastlane</h2>
<p>If you want to access those values from within your <code>Fastfile</code> use</p>
<pre><code class="ruby">identifier = CredentialsManager::AppfileConfig.try_fetch_value(:app_identifier)
team_id = CredentialsManager::AppfileConfig.try_fetch_value(:team_id)
</code></pre>

<h1 id="building-actions"><a name="user-content-building-actions" href="#building-actions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Building Actions</h1>
<h2 id="using-fastlanecoreconfiguration"><a name="user-content-using-fastlanecoreconfiguration" href="#using-fastlanecoreconfiguration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Using FastlaneCore::Configuration</h2>
<p>Most actions accept one or more parameters to customize their behavior. Actions define their
parameters in an <code>available_options</code> method. This method returns an array of <code>FastlaneCore::ConfigItem</code>
objects to describe supported options. Each option is declared by creating a new
<code>ConfigItem</code>, e.g.:</p>
<pre><code class="ruby">FastlaneCore::ConfigItem.new(
  key: :file,
  env_name: &quot;MY_NEW_ACTION_FILE&quot;,
  description: &quot;A file to operate on&quot;,
  type: String,
  optional: false
)
</code></pre>

<p>This declares a <code>file</code> option for use with the action in a Fastfile, e.g.:</p>
<pre><code class="ruby">my_new_action(file: &quot;file.txt&quot;)
</code></pre>

<p>If the optional <code>env_name</code> is present, an environment variable with the specified
name may also be used in place of an option in the Fastfile:</p>
<pre><code class="bash">MY_NEW_ACTION_FILE=file.txt fastlane run my_new_action
</code></pre>

<p>The <code>type</code> argument to the <code>FastlaneCore::ConfigItem</code> initializer specifies the
name of a Ruby class representing a standard
data type. Supplied arguments will be coerced to the specified type. Some standard types
support default conversions.</p>
<h3 id="boolean-parameters"><a name="user-content-boolean-parameters" href="#boolean-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Boolean parameters</h3>
<p>Ruby does not have a single class to represent a Boolean type. When specifying
Boolean parameters, use <code>is_string: false</code>, without specifying a <code>type</code>, e.g.:</p>
<pre><code class="ruby">FastlaneCore::ConfigItem.new(
  key: :commit,
  env_name: &quot;MY_NEW_ACTION_COMMIT&quot;,
  description: &quot;Commit the results if true&quot;,
  optional: true,
  default_value: false,
  is_string: false
)
</code></pre>

<p>When passing a string value, e.g. from an environment variable, certain set
string values are recognized:</p>
<pre><code class="bash">MY_NEW_ACTION_COMMIT=true
MY_NEW_ACTION_COMMIT=false
MY_NEW_ACTION_COMMIT=yes
MY_NEW_ACTION_COMMIT=no
</code></pre>

<p>These values may also be passed in all caps, e.g. <code>MY_NEW_ACTION_COMMIT=YES</code>.</p>
<h3 id="array-parameters"><a name="user-content-array-parameters" href="#array-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Array parameters</h3>
<p>If a parameter is declared with <code>type: Array</code> and a <code>String</code> argument is passed,
an array will be produced by splitting the string using the comma character
as a delimiter:</p>
<pre><code class="ruby">FastlaneCore::ConfigItem.new(
  key: :files,
  env_name: &quot;MY_NEW_ACTION_FILES&quot;,
  description: &quot;One or more files to operate on&quot;,
  type: Array,
  optional: false
)
</code></pre>

<pre><code class="ruby">my_new_action(files: &quot;file1.txt,file2.txt&quot;)
</code></pre>

<p>This is received by the action as <code>["file1.txt", "file2.txt"]</code>.</p>
<p>This also means a parameter that accepts an array may take a single string as an
argument:</p>
<pre><code class="ruby">my_new_action(files: &quot;file.txt&quot;)
</code></pre>

<p>This is received by the action as <code>["file.txt"]</code>.</p>
<p>Comma-separated lists are particularly useful when using environment variables:</p>
<pre><code class="bash">export MY_NEW_ACTION_FILES=file1.txt,file2.txt
</code></pre>

<h3 id="polymorphic-parameters"><a name="user-content-polymorphic-parameters" href="#polymorphic-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Polymorphic parameters</h3>
<p>To allow for different types to be passed to a parameter (beyond what is
provided above), specify <code>is_string: false</code> without a <code>type</code> field. Use
an optional <code>verify_block</code> argument (see below) or verify the argument within
your action. If the block does not raise, the option is considered verified.
The <code>UI.user_error!</code> method is a convenient way to handle verification failure.</p>
<pre><code class="Ruby">FastlaneCore::ConfigItem.new(
  key: :polymorphic_option,
  is_string: false,
  verify_block: -&gt;(value) { verify_option(value) }
)

def verify_option(value)
  case value
  when String
    @polymorphic_option = value
  when Array
    @polymorphic_option = value.join(&quot; &quot;)
  when Hash
    @polymorphic_option = value.to_s
  else
    UI.user_error! &quot;Invalid option: #{value.inspect}&quot;
  end
end
</code></pre>

<h3 id="callback-parameters"><a name="user-content-callback-parameters" href="#callback-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Callback parameters</h3>
<p>If your action needs to provide a callback, specify <code>Proc</code> for the <code>type</code> field.</p>
<pre><code class="Ruby">FastlaneCore::ConfigItem.new(
  key: :callback,
  description: &quot;Optional callback argument&quot;,
  optional: true,
  type: Proc
)
</code></pre>

<p>To invoke the callback in your action, use the <code>Proc#call</code> method and pass
any arguments:</p>
<pre><code class="Ruby">params[:callback].call(result) if params[:callback]
</code></pre>

<p>To notify the user of success or failure, it's usually best just to return a
value such as <code>true</code> or <code>false</code> from your action. Use a callback for contextual
error handling. For example, the built-in <code>sh</code> action passes the entire command
output to an optional <code>error_callback</code>:</p>
<pre><code class="Ruby">callback = lambda do |result|
  handle_missing_file if result =~ /file not found/i
  handle_auth_failure if result =~ /login failed/i
end

sh &quot;some_cmd&quot;, error_callback: callback
</code></pre>

<h3 id="note-on-procs"><a name="user-content-note-on-procs" href="#note-on-procs" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Note on Procs</h3>
<p>When passing a block as a parameter to an action or ConfigItem, use
a Proc object. There are three ways to create an instance of Proc in Ruby.</p>
<p>Using the <code>lambda</code> operator:</p>
<pre><code class="Ruby">verify_block = lambda do |value|
  ...
end
</code></pre>

<p>Using <code>Proc.new</code>:</p>
<pre><code class="Ruby">verify_block = Proc.new do |value|
  ...
end
</code></pre>

<p>Using the <code>Proc</code> literal notation:</p>
<pre><code class="Ruby">verify_block = -&gt;(value) { ... }
</code></pre>

<p>Note that you cannot pass a block literal as a <code>Proc</code>.</p>
<h3 id="verify-blocks"><a name="user-content-verify-blocks" href="#verify-blocks" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Verify blocks</h3>
<p>Use a <code>verify_block</code> argument with your <code>ConfigItem</code> to provide special
argument verification:</p>
<pre><code class="Ruby">verify_block = lambda do |value|
  # Has to be a String to get this far
  uri = URI(value)
  UI.error &quot;Invalid scheme #{uri.scheme}&quot; unless uri.scheme == &quot;http&quot; || uri.scheme == &quot;https&quot;
end

FastlaneCore::ConfigItem.new(
  key: :url,
  type: String,
  verify_block: verify_block
)
</code></pre>

<p>The <code>verify_block</code> requires a <code>Proc</code> argument (see above).</p>
<h3 id="conflicting-options"><a name="user-content-conflicting-options" href="#conflicting-options" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Conflicting options</h3>
<p>If your action includes multiple conflicting options, use <code>conflicting_options</code>
in the <code>ConfigItem</code> for each. Make sure conflicting options are optional.</p>
<pre><code class="Ruby">FastlaneCore::ConfigItem.new(
  key: :text,
  type: String,
  optional: true,
  conflicting_options: [:text_file]
),
FastlaneCore::ConfigItem.new(
  key: :text_file,
  type: String,
  optional: true,
  conflicting_options: [:text]
)
</code></pre>

<p>You can also pass a <code>conflict_block</code> (a <code>Proc</code>, see above) if you want to
implement special handling of conflicting options:</p>
<pre><code class="Ruby">conflict_block = Proc.new do |other|
  UI.user_error! &quot;Unexpected conflict with option #{other}&quot; unless [:text, :text_file].include?(other)
  UI.message &quot;Ignoring :text_file in favor of :text&quot;
end

FastlaneCore::ConfigItem.new(
  key: :text,
  type: String,
  optional: true,
  conflicting_options: [:text_file],
  conflict_block: conflict_block
),
FastlaneCore::ConfigItem.new(
  key: :text_file,
  type: String,
  optional: true,
  conflicting_options: [:text],
  conflict_block: conflict_block
)
</code></pre>

<h3 id="optional-parameters"><a name="user-content-optional-parameters" href="#optional-parameters" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Optional parameters</h3>
<p>Parameters with <code>optional: true</code> will be <code>nil</code> unless a <code>default_value</code> field
is present. Make sure the <code>default_value</code> is reasonable unless it's acceptable
for the key to be absent.</p>
<pre><code class="Ruby">FastlaneCore::ConfigItem.new(
  key: :build_configuration,
  description: &quot;Which build configuration to use&quot;,
  type: String,
  optional: true,
  default_value: &quot;Release&quot;
),
FastlaneCore::ConfigItem.new(
  key: :offset,
  description: &quot;Offset to start from&quot;,
  type: Integer,
  optional: true,
  default_value: 0
),
FastlaneCore::ConfigItem.new(
  key: :workspace,
  description: &quot;Optional workspace path&quot;,
  type: String,
  optional: true
  # Not every project has a workspace, so nil is a good default value here.
)
</code></pre>

<p>Within the action <code>params[:build_configuration]</code> will never be nil. Specifying
the <code>default_value</code> is preferable to something in code like:</p>
<pre><code class="Ruby">config = params[:build_configuration] || &quot;Release&quot;
</code></pre>

<p>Default values are included in the documentation for action parameters.</p>
<h3 id="configuration-files"><a name="user-content-configuration-files" href="#configuration-files" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Configuration files</h3>
<p>Many built-in actions such as <em>deliver</em>, <em>gym</em> and <em>scan</em> support configuration files
(<code>Deliverfile</code>, <code>Gymfile</code>, <code>Scanfile</code>). This is useful for actions with many options.
To add support for a configuration file to a custom action, call <code>load_configuration_file</code>
early, usually as the first line of <code>run</code>:</p>
<pre><code class="ruby">def self.run(params)
  params.load_configuration_file(&quot;MyNewActionfile&quot;)
  # ...
</code></pre>

<p>This will load any parameters specified in <code>MyNewActionfile</code>. This method looks for
the specified file in <code>./fastlane</code>, <code>./.fastlane</code> and <code>.</code>, in that order. The
file is evaluated by the Ruby interpreter.
You may specify they <code>key</code> from any <code>FastlaneCore::ConfigItem</code> as a method call in the
configuration file:</p>
<pre><code class="ruby">command &quot;ls -la&quot;
files %w{file1.txt file2.txt}
</code></pre>

<h3 id="resolution-order"><a name="user-content-resolution-order" href="#resolution-order" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Resolution order</h3>
<p>Parameters are resolved from different sources in the following order:</p>
<ol>
<li>A parameter directly passed to an action using the <code>key</code>, usually from the <code>Fastfile</code>.</li>
<li>An environment variable, if the <code>env_name</code> is set.</li>
<li>A configuration file used in <code>load_configuration_file</code>.</li>
<li>The <code>default_value</code> of the <code>ConfigItem</code>. If not explicitly set, this will be <code>nil</code>.</li>
</ol>
<h2 id="user-input-and-output"><a name="user-content-user-input-and-output" href="#user-input-and-output" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>User input and output</h2>
<p>The <code>FastlaneCore::UI</code> utility may be used to display output to the user and also
request input from an action.
<code>UI</code> includes a number of methods to customize the output for different purposes:</p>
<pre><code class="ruby">UI.message &quot;Hello from my_new_action.&quot;
UI.important &quot;Warning: This is a new action.&quot;
UI.error &quot;Something unexpected happened in my_new_action. Attempting to continue.&quot;
</code></pre>

<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>error</td>
<td>Displays an error message in red</td>
</tr>
<tr>
<td>important</td>
<td>Displays a warning or other important message in yellow</td>
</tr>
<tr>
<td>success</td>
<td>Displays a success message in green</td>
</tr>
<tr>
<td>message</td>
<td>Displays a message in the default output color</td>
</tr>
<tr>
<td>deprecated</td>
<td>Displays a deprecation message in bold blue</td>
</tr>
<tr>
<td>command</td>
<td>Displays a command being executed in cyan</td>
</tr>
<tr>
<td>command_output</td>
<td>Displays command output in magenta</td>
</tr>
<tr>
<td>verbose</td>
<td>Displays verbose output in the default output color</td>
</tr>
<tr>
<td>header</td>
<td>Displays a message in a box for emphasis</td>
</tr>
</tbody>
</table>
<p>Methods ending in an exclamation point (<code>!</code>) terminate execution of the current
lane and report an error:</p>
<pre><code class="ruby">UI.user_error! &quot;Could not open file #{file_path}&quot;
</code></pre>

<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>crash!</td>
<td>Report a catastrophic error</td>
</tr>
<tr>
<td>user_error!</td>
<td>Rescue an exception in your action and report a nice message to the user</td>
</tr>
<tr>
<td>shell_error!</td>
<td>Report failure of a shell command</td>
</tr>
<tr>
<td>build_failure!</td>
<td>Report a build failure</td>
</tr>
<tr>
<td>test_failure!</td>
<td>Report a test failure</td>
</tr>
<tr>
<td>abort_with_message!</td>
<td>Report a failure condition that prevents continuing</td>
</tr>
</tbody>
</table>
<p>Note that these methods raise exceptions that are rescued in the runner context for
the lane. This terminates further lane execution, so it is not necessary to return.</p>
<pre><code class="ruby"># No need for &quot;and return&quot; here
UI.user_error!(&quot;Could not open file #{file_path}&quot;) and return if file.nil?
</code></pre>

<p>The following methods may be used to prompt the user for input.</p>
<pre><code class="ruby">if UI.interactive?
  name = UI.input &quot;Please enter your name: &quot;
  is_correct = UI.confirm &quot;Is this correct? &quot;
  choice = UI.select &quot;Please choose from the following list:&quot;, %w{alpha beta gamma}
  password = UI.password &quot;Please enter your password: &quot;
end
</code></pre>

<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>interactive?</td>
<td>Indicates whether interactive input is possible</td>
</tr>
<tr>
<td>input</td>
<td>Prompt the user for string input</td>
</tr>
<tr>
<td>confirm</td>
<td>Ask the user a binary question</td>
</tr>
<tr>
<td>select</td>
<td>Prompt the user to select from a list of options</td>
</tr>
<tr>
<td>password</td>
<td>Prompt the user for a password (masks output)</td>
</tr>
</tbody>
</table>
<h2 id="invoking-shell-commands"><a name="user-content-invoking-shell-commands" href="#invoking-shell-commands" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Invoking shell commands</h2>
<p>If your action needs to run a shell command, there are several methods. You can
easily determine the exit status of the command and capture all terminal output
from the command.</p>
<h3 id="using-kernelsystem"><a name="user-content-using-kernelsystem" href="#using-kernelsystem" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Using Kernel#system</h3>
<p>Use the Ruby <code>system</code> method call to invoke a command string. This does not
redirect stdin, stdout or stderr, so output formatting will be unaffected. It executes
the command in a subshell.</p>
<pre><code class="ruby">system &quot;cat fastlane/Fastfile&quot;
</code></pre>

<p>Upon command completion, the method returns true or false to indicate completion
status. The <code>$?</code> global variable will also indicate the exit status of the
command.</p>
<pre><code class="ruby">system &quot;cat fastlane/Fastfile&quot;
UI.user_error! &quot;Could not execute command&quot; unless $?.exitstatus == 0
</code></pre>

<p>If the command to be executed is not found, system will return <code>nil</code>, and
<code>$?.exitstatus</code> will be nonzero.</p>
<h3 id="using-backticks"><a name="user-content-using-backticks" href="#using-backticks" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Using backticks</h3>
<p>To capture the output of a command, enclose the command in backticks:</p>
<pre><code class="ruby">pod_cmd = `which pod`
UI.important &quot;'pod' command not found&quot; if pod_cmd.empty?
</code></pre>

<p>Because you are capturing stdout, the command output will not appear at
the terminal unless you log it using <code>UI</code>. Formatting may be lost when
capturing command output. The entire output to stdout will be captured after the
command returns. Output to stderr is not captured or redirected. The <code>$?</code>
global variable will indicate the completion status of the command.</p>
<p>If the command to be executed is not found, <code>Errno::ENOENT</code> is raised.</p>
<h3 id="using-the-sh-method"><a name="user-content-using-the-sh-method" href="#using-the-sh-method" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Using the sh method</h3>
<p>You can also use the built-in <code>sh</code> method:</p>
<pre><code class="ruby">sh &quot;pwd&quot;
</code></pre>

<p>This is called the same way in an action as in a Fastfile. This provides consistent
logging of command output. All output to stdout and stderr is logged via <code>UI</code>.</p>
<p>The <code>sh</code> method can accept a block, which will receive the <code>Process::Status</code>
returned by the command, the complete output of the command, and an equivalent
shell command upon completion of the command.</p>
<pre><code class="ruby">sh &quot;ls&quot;, &quot;-la&quot; do |status, result, command|
  unless status.success?
    UI.error &quot;Command #{command} (pid #{status.pid}) failed with status #{status.exitstatus}&quot;
  end
  UI.message &quot;Output is #{result.inspect}&quot;
end
</code></pre>

<p>To be notified only when an error occurs, use the <code>error_callback</code> parameter
(a Proc):</p>
<pre><code class="ruby">success = true
sh(&quot;pwd&quot;, error_callback: -&gt;(result) { success = false })
UI.user_error &quot;Command failed&quot; unless success
</code></pre>

<p>The <code>result</code> argument to the <code>error_callback</code> is the entire string output
of the command.</p>
<p>If the command to be executed is not found, <code>Errno::ENOENT</code> is raised without
calling the block or <code>error_callback</code>.</p>
<p>If an <code>error_callback</code> or block is not provided, and the command executes and
returns an error, an exception is raised, and lane execution is terminated
unless the exception is rescued. The exit status of the command will be available in <code>$?</code>. It is also available
as the first argument to a block.</p>
<p>The return value of the method is the output of the command, unless a block is
given. Then the output is available within the block, and the return value of
<code>sh</code> is the return value of the block. This enables usage like:</p>
<pre><code class="ruby">if sh command { |s| s.success? }
  UI.success &quot;Command succeeded&quot;
else
  UI.error &quot;Command failed&quot;
end
</code></pre>

<p>Anywhere other than an action or a Fastfile (e.g. in helper code), you can
invoke this method as <code>Actions.sh</code>.</p>
<h3 id="escaping-in-shell-commands"><a name="user-content-escaping-in-shell-commands" href="#escaping-in-shell-commands" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Escaping in shell commands</h3>
<p>Use <code>shellwords</code> to escape arguments to shell commands.</p>
<pre><code class="Ruby">`git commit -aqm #{Shellwords.escape commit_message}`
</code></pre>

<pre><code class="Ruby">system &quot;cat #{path.shellescape}&quot;
</code></pre>

<p>When using <code>system</code> or <code>sh</code>, pass a list of arguments instead of shell-escaping
individual arguments.</p>
<pre><code class="Ruby">sh &quot;git&quot;, &quot;commit&quot;, &quot;-aqm&quot;, commit_message
system &quot;cat&quot;, path
</code></pre>

<h2 id="calling-other-actions"><a name="user-content-calling-other-actions" href="#calling-other-actions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Calling other actions</h2>
<p>Some built-in utility actions, such as <code>sh</code>, may be used in custom actions (e.g., in
plugins). It's not generally a good idea to call a complex action from another action.
In particular:</p>
<ul>
<li>If you're calling one plugin action from another plugin action, you should
  probably refactor your plugin helper to be more easily called from all actions
  in the plugin.</li>
<li>Avoid wrapping complex built-in actions like <em>deliver</em> and <em>gym</em>.</li>
<li>There can be issues with one plugin depending on another plugin.</li>
<li>Certain simple built-in utility actions may be used with <code>other_action</code> in your
  action, such as: <code>other_action.git_add</code>, <code>other_action.git_commit</code>.</li>
<li>Think twice before calling an action from another action. There is often a better
  solution.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../best-practices/keys/" class="btn btn-neutral" title="Keys"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div class="fastlane" role="contentinfo">
    <p>
      <a href="https://github.com/fastlane/fastlane" target="_blank">
        <img src="/img/fastlane_text.png" width="200" />
      </a>
      <iframe src="https://ghbtns.com/github-btn.html?user=fastlane&repo=fastlane&type=watch&count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20" class="githubButton"></iframe>
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a> - Copyright &copy; 2018 <a href="https://fastlane.tools">fastlane</a>
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/fastlane/docs" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../best-practices/keys/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>

</body>
</html>
